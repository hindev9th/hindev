<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no, user-scalable=no">
	<title>LocaTalk.AI Session Client</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
		rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

	<link rel="stylesheet" href="./assets/css/style.css">

	<!-- Google Identity Services SDK -->
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script src="./assets/scripts/block-zoom.js" defer type="module"></script>
</head>

<body data-bs-theme="light">
	<div id="site" class="site">
		<div class="section-bg ellipse" style="background-image: url(assets/images/bg-ellipse.png);"></div>
		<div class="section-bg waves" style="background-image: url(assets/images/bg-waves.png);"></div>
		<nav class="navbar navbar-expand-lg navbar-dark fixed-top top-navbar">
			<div class="container-fluid justify-content-between">
				<a class="navbar-brand" href="index.html">
					<img id="brandLogo" src="./assets/images/header-logo.svg" alt="LocaTalk.AI">
				</a>
				<!-- <ul class="navbar-nav ms-auto justify-content-end">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle dropdown-profile" href="#" role="button"
							data-bs-toggle="dropdown" aria-expanded="false">
							<img width="48" height="48" src="assets/images/icon-user.png" />
						</a>
						<ul class="dropdown-menu dropdown-menu-end effect-glass">
							<li><a class="dropdown-item" href="sign-in.html"><img width="24" height="24"
										src="assets/images/icons/icon-user.svg" />Sign In</a></li>
						</ul>
					</li>
				</ul> -->
			</div>
		</nav>
		<div class="site-content">
			<div class="page-content page-sign-in">
				<div class="container-xl h-100">
					<div class="row justify-content-center h-100">
						<div class="col-md-4">
							<div class="layout-full-height">
								<div class="sec-header text-md-center">
									<h1 class="sec-title">Greeting from Nguyen Van A!</h1>
									<p class="sec-description">Please sign in to join the session</p>
								</div>
								<div class="form-grid">
									<button class="btn btn-glass effect-glass" id="signin_Google">
										<img width="24" height="24" src="assets/images/logo-google.svg" />
										<span>Sign in with Google</span>
									</button>
									<button class="btn btn-glass effect-glass" id="signin_Apple">
										<img width="24" height="24" src="assets/images/logo-apple.svg" />
										<span>Sign in with Apple</span>
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="modalWebView" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="modalWebViewLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-body text-center">
						<div id="open-browser-hint" class="alert alert-warning text-start mt-3">
							<h5>⚠️ You’re opening this page inside an app</h5>
							<p>To use all features, please open it in an external browser:</p>
							<ol>
								<li>Tap the <b>⋮</b> or <b>•••</b> icon in the top-right corner.</li>
								<li>Select <b>“Open in Chrome”</b> (Android) or <b>“Open in Safari”</b> (iPhone).</li>
							</ol>
							<button id="copyBtn"
								class="btn btn-primary btn-sm w-100 mt-2 d-flex justify-content-center align-items-center gap-2">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 16 16">
									<path
										d="M10 1.5A1.5 1.5 0 0 1 11.5 3v9A1.5 1.5 0 0 1 10 13.5H3A1.5 1.5 0 0 1 1.5 12V3A1.5 1.5 0 0 1 3 1.5h7zM3 0a3 3 0 0 0-3 3v9a3 3 0 0 0 3 3h7a3 3 0 0 0 3-3V3a3 3 0 0 0-3-3H3z" />
									<path d="M13 4.5V13a2 2 0 0 1-2 2H5a.5.5 0 0 0 0 1h6a3 3 0 0 0 3-3V4.5a.5.5 0 0 0-1 0z" />
								</svg>
								Copy Link
							</button>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
		crossorigin="anonymous"></script>
	<script type="module" src="assets/scripts/check-webview.js"></script>

	<script>
		window.document.addEventListener("DOMContentLoaded", function () {
			// Google Sign-In Button click
			const btnSignInGoogle = document.getElementById("signin_Google");

			btnSignInGoogle.addEventListener("click", function () {
				// Gọi hàm Google Sign-In
				console.log("Origin:", window.location.origin);
				google.accounts.id.initialize({
					client_id: "804080842146-ssbcu8er3asgs3hij2cv2e8kk10ghjk8.apps.googleusercontent.com",
					callback: handleCredentialResponse,
					use_fedcm_for_prompt: true,
					auto_select: false,
				});

				// Dùng popup (không auto render)
				google.accounts.id.prompt(); // Mở One Tap / popup tuỳ theo trình duyệt
			});

			// Xử lý response khi user đăng nhập xong
			function handleCredentialResponse(response) {
				const idToken = response.credential;
				const user = parseJwt(idToken);

				if (!user) {
					alert("Login failed");
					return;
				}

				// Lưu thông tin user vào localStorage (demo)
				localStorage.setItem("google_user", JSON.stringify(user));

				// (Tùy chọn) Gửi token về server để verify
				/*
				fetch("/api/auth/google", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ id_token: idToken }),
				});
				*/

				// Chuyển trang (giống như bạn đang làm)
				location.href = "index.html";
			}

			// Giải mã JWT (id_token)
			function parseJwt(token) {
				try {
					const base64Url = token.split(".")[1];
					const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
					const jsonPayload = decodeURIComponent(
						atob(base64)
							.split("")
							.map((c) => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
							.join("")
					);
					return JSON.parse(jsonPayload);
				} catch (e) {
					return null;
				}
			}
		});
	</script>
</body>

</html>
